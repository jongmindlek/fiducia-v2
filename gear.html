<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./styles.css"/>
  <title>Gear | Fiducia</title>
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand">FIDUCIA COLLECTIVE</div>
      <div class="nav-links">
        <a class="tab" href="./index.html">메인</a>
        <a class="tab" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab active" href="./gear.html">장비 예약</a>
        <a class="tab" href="./crew.html">감독/스태프 리스트</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h2 style="margin:0 0 12px">gear reservation</h2>
    <div id="gearList" class="list"></div>
    <div id="gearEmpty" class="small" style="display:none;margin-top:6px">장비를 불러오는 중...</div>
  </main>

  <script type="module">
    const listEl = document.querySelector("#gearList");
    const emptyEl = document.querySelector("#gearEmpty");

    const safeThumb = (url)=> url
      ? `<img src="${url}" alt="gear" loading="lazy"/>`
      : `<div class="thumb">no image</div>`;

    async function load(){
      emptyEl.style.display="block";
      try{
        const res = await fetch("/api/gear");
        const gears = await res.json();
        listEl.innerHTML="";
        if(!Array.isArray(gears) || gears.length===0){
          emptyEl.textContent="표시할 장비가 없어요.";
          return;
        }
        emptyEl.style.display="none";
        gears.forEach(g=>{
          const card = document.createElement("div");
          card.className="card person";
          card.innerHTML=`
            <div class="thumb">${safeThumb(g.thumbnailUrl)}</div>
            <div class="name">${g.brandModel || g.name || "Gear"}</div>
            <div class="small">${g.category || ""} · ${g.status || ""}</div>
            <div class="row" style="justify-content:space-between; margin-top:8px">
              <div class="small">Day rate: ${g.dayRate ?? "-"}</div>
              <a class="action-btn" href="./gear-reservation.html?gearId=${encodeURIComponent(g.id)}">예약하기</a>
            </div>
          `;
          listEl.appendChild(card);
        });
      }catch(e){
        emptyEl.textContent="장비 불러오기 실패";
      }
    }
    load();
  </script>
</body>
</html>