<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./style.css"/>
  <title>AI Stillcut Reservation Form</title>
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand">FIDUCIA COLLECTIVE</div>
      <div class="nav-links">
        <a class="tab" href="./index.html">메인</a>
        <a class="tab active" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab" href="./gear.html">장비 예약</a>
        <a class="tab" href="./crew.html">감독/스태프 리스트</a>
        <a class="tab" href="./crew.html#register">감독/스태프 등록</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <section class="card" style="grid-column: span 12;">
      <h2>AI 스틸컷 예약 폼</h2>
      <p class="small">아래 정보를 작성하면 노션 <b>AI Stillcut Reservation DB</b>로 자동 저장됩니다.</p>

      <form id="stillcutForm" class="form" style="margin-top:14px; display:grid; gap:12px;">

        <!-- 연락처 -->
        <div class="form-row">
          <label>예약자 이름 *</label>
          <input name="clientName" required placeholder="이름"/>
        </div>

        <div class="form-row">
          <label>카카오톡 ID/연락처 *</label>
          <input name="clientKakao" required placeholder="카톡 아이디 또는 전화번호"/>
        </div>

        <!-- 러닝타임 -->
        <div class="form-row">
          <label>러닝타임(분) *</label>
          <input name="runtimeMin" type="number" min="1" required placeholder="예: 30"/>
          <div class="small">숫자만 입력</div>
        </div>

        <!-- 영상 타입 -->
        <div class="form-row">
          <label>영상 타입 *</label>
          <select name="videoType" required>
            <option value="">선택</option>
            <option>영화</option>
            <option>뮤비</option>
            <option>웨딩</option>
            <option>광고</option>
            <option>기타</option>
          </select>
        </div>

        <!-- 예산 범위 -->
        <div class="form-row">
          <label>예산 범위 *</label>
          <select name="budgetRange" required>
            <option value="">선택</option>
            <option>50만원 ~ 100만원</option>
            <option>100만원 ~ 200만원</option>
            <option>200만원 ~ 300만원</option>
            <option>300만원 이상</option>
          </select>
        </div>

        <!-- 희망 촬영 날짜 -->
        <div class="form-row">
          <label>희망 촬영 날짜 *</label>
          <input name="shootDate" type="date" required />
        </div>

        <!-- 촬영 장소 -->
        <div class="form-row">
          <label>촬영 장소 *</label>
          <input name="location" required placeholder="예: 부산 / 서울 강남 / 실내 스튜디오 등"/>
        </div>

        <!-- 레퍼런스 링크 -->
        <div class="form-row">
          <label>레퍼런스 링크</label>
          <input name="referenceUrl" type="url" placeholder="드라이브/유튜브/핀터레스트 등 URL"/>
        </div>

        <!-- 이미지 파일(메타만 저장) -->
        <div class="form-row">
          <label>이미지 파일 (최대 5개)</label>
          <input id="imageFiles" name="imageFiles" type="file" accept="image/*" multiple />
          <div id="fileHint" class="small" style="margin-top:4px; opacity:.8;">
            파일은 메타정보만 저장됩니다. 원본은 카톡/드라이브 링크로 전달 부탁!
          </div>
        </div>

        <!-- 상세 요청 -->
        <div class="form-row">
          <label>요청 내용 *</label>
          <textarea name="request" required rows="5" placeholder="원하시는 분위기/장면/캐릭터/참고사항 등"></textarea>
        </div>

        <button id="submitBtn" class="cta" type="submit" style="width:100%; margin-top:6px;">
          예약 제출
        </button>
        <div id="status" class="small" style="margin-top:8px;"></div>
      </form>
    </section>
  </main>

  <footer class="footer">
    <div class="container row" style="justify-content:space-between">
      <div>© Fiducia Collective</div>
      <div class="row">
        <span>Instagram</span>
        <span>Contact</span>
      </div>
    </div>
  </footer>

  <script type="module">
    const form = document.querySelector("#stillcutForm");
    const statusEl = document.querySelector("#status");
    const submitBtn = document.querySelector("#submitBtn");
    const fileInput = document.querySelector("#imageFiles");

    function getFileMeta(files){
      const arr = Array.from(files || []).slice(0,5);
      return arr.map(f => ({
        name: f.name,
        size: f.size,
        type: f.type
      }));
    }

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      statusEl.textContent = "";
      submitBtn.disabled = true;

      const fd = new FormData(form);
      const payload = {
        clientName: fd.get("clientName")?.trim(),
        clientKakao: fd.get("clientKakao")?.trim(),
        runtimeMin: Number(fd.get("runtimeMin")),
        videoType: fd.get("videoType"),
        budgetRange: fd.get("budgetRange"),
        shootDate: fd.get("shootDate"),
        location: fd.get("location")?.trim(),
        referenceUrl: fd.get("referenceUrl")?.trim() || "",
        imageFiles: getFileMeta(fileInput.files),
        request: fd.get("request")?.trim(),
      };

      try{
        const res = await fetch("/api/stillcut", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if(!res.ok){
          throw new Error(data?.message || "예약 실패");
        }
        statusEl.textContent = "예약 완료! 곧 카카오톡으로 연락드릴게요.";
        form.reset();
      }catch(err){
        statusEl.textContent = "예약 실패: " + err.message;
      }finally{
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>