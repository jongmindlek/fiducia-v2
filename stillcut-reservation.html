<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./style.css"/>
  <title>AI Stillcut Reservation | Fiducia</title>
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand">FIDUCIA COLLECTIVE</div>
      <div class="nav-links">
        <a class="tab" href="./index.html">메인</a>
        <a class="tab active" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab" href="./gear.html">장비 예약</a>
        <a class="tab" href="./crew.html">감독/스태프 리스트</a>
        <a class="tab" href="./crew.html#register">감독/스태프 등록</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h1 style="margin-top:24px">AI Stillcut Reservation</h1>

    <section class="card" style="margin-top:12px">
      <form id="form" class="grid" style="gap:12px">

        <!-- 이름 -->
        <div style="grid-column: span 12;">
          <label class="small">이름 *</label>
          <input class="input" name="name" required />
        </div>

        <!-- 연락처 / 이메일 -->
        <div style="grid-column: span 6;">
          <label class="small">연락처 *</label>
          <input class="input" name="phone" required />
        </div>

        <div style="grid-column: span 6;">
          <label class="small">이메일</label>
          <input class="input" name="email" type="email" />
        </div>

        <!-- 프로젝트 제목 -->
        <div style="grid-column: span 12;">
          <label class="small">프로젝트 제목 *</label>
          <input class="input" name="projectTitle" required />
        </div>

        <!-- 영상 타입 -->
        <div style="grid-column: span 6;">
          <label class="small">영상 타입 *</label>
          <select class="select" name="videoType" required>
            <option value="">선택</option>
            <option>Film</option>
            <option>Music Video</option>
            <option>Commercial</option>
            <option>Wedding</option>
            <option>Other</option>
          </select>
        </div>

        <!-- 러닝타임 -->
        <div style="grid-column: span 6;">
          <label class="small">러닝타임</label>
          <input class="input" name="runtime" placeholder="ex) 30초 / 3분 / 장편" />
        </div>

        <!-- 예산 -->
        <div style="grid-column: span 6;">
          <label class="small">예산 범위</label>
          <select class="select" name="budgetRange">
            <option value="">선택</option>
            <option value="50만원 ~ 100만원">50만원 ~ 100만원</option>
            <option value="100만원 ~ 200만원">100만원 ~ 200만원</option>
            <option value="200만원 ~ 300만원">200만원 ~ 300만원</option>
            <option value="300만원 이상">300만원 이상</option>
          </select>
        </div>

        <!-- 희망촬영일 -->
        <div style="grid-column: span 6;">
          <label class="small">희망 촬영 날짜</label>
          <input class="input" name="desiredShootDate" type="date" />
        </div>

        <!-- 촬영 장소 -->
        <div style="grid-column: span 12;">
          <label class="small">촬영 장소</label>
          <input class="input" name="location" placeholder="ex) 서울 / 부산 / OO스튜디오" />
        </div>

        <!-- 레퍼런스 링크 -->
        <div style="grid-column: span 12;">
          <label class="small">레퍼런스 링크 (드라이브/유튜브/핀터레스트 등)</label>
          <input class="input" name="referenceUrl" placeholder="https://..." />
        </div>

        <!-- 이미지 파일 -->
        <div style="grid-column: span 12;">
          <label class="small">이미지 파일 (최대 5개)</label>
          <input class="input" id="imageFiles" name="imageFiles" type="file" accept="image/*" multiple />
          <div id="fileHint" class="small" style="margin-top:6px;opacity:.8">
            ※ 파일은 메타 정보만 저장됩니다. 실제 파일은 카카오톡/드라이브 링크로 전달 부탁드립니다.
          </div>
          <div id="fileList" class="small" style="margin-top:6px"></div>
        </div>

        <!-- 요청 내용 -->
        <div style="grid-column: span 12;">
          <label class="small">요청 내용 *</label>
          <textarea class="textarea" name="message" rows="6" required></textarea>
        </div>

        <!-- 버튼/상태 -->
        <div style="grid-column: span 12;" class="row" style="gap:10px">
          <button class="cta" type="submit">예약 제출</button>
          <span id="status" class="small"></span>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer">
    <div class="container row" style="justify-content:space-between">
      <div>© Fiducia Collective</div>
      <div class="row">
        <span>Instagram</span>
        <span>Contact</span>
      </div>
    </div>
  </footer>

  <script type="module">
    const form = document.querySelector("#form");
    const status = document.querySelector("#status");
    const imageFilesEl = document.querySelector("#imageFiles");
    const fileListEl = document.querySelector("#fileList");

    let fileMeta = [];

    imageFilesEl.addEventListener("change", () => {
      const files = Array.from(imageFilesEl.files || []).slice(0, 5);
      fileMeta = files.map(f => ({
        name: f.name,
        size: f.size,
        type: f.type
      }));
      fileListEl.innerHTML = files.length
        ? files.map(f => `• ${f.name} (${Math.round(f.size/1024)}KB)`).join("<br/>")
        : "";
    });

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      status.textContent = "전송 중...";

      const fd = new FormData(form);
      const payload = Object.fromEntries(fd.entries());
      payload.imageFiles = fileMeta;

      try{
        const res = await fetch("/api/stillcut-reserve",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if(!res.ok) throw new Error(data.message || "예약 실패");

        status.textContent = "예약 완료! 곧 연락드릴게요.";
        form.reset();
        fileListEl.innerHTML="";
        fileMeta=[];
      }catch(err){
        status.textContent = "예약 실패: " + err.message;
      }
    });
  </script>
</body>
</html>