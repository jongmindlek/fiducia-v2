<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Crew List</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css" />
<link rel="stylesheet" href="./style.css"/>
</head>

<body>
<div class="page"><div class="inner">

  <div class="nav-wrap">
    <nav class="nav">
      <div class="nav-logo">FIDUCIA COLLECTIVE</div>
      <div class="nav-menu">
        <a href="index.html">메인</a>
        <a href="stillcut.html">AI 스틸컷(예약)</a>
        <a href="gear.html">장비 예약</a>
        <a href="crew-list.html" class="is-active">감독/스태프 리스트</a>
        <a href="register.html">감독/스태프 등록</a>
      </div>
    </nav>
  </div>

  <main>
    <h2 class="section-title" style="margin-top:20px;">crew</h2>

    <div class="crew-filters">
      <input id="crew-search" placeholder="이름/키워드 검색" />
      <select id="crew-skill-filter">
        <option value="">Skill 전체</option>
        <option value="Film">Film</option>
        <option value="Music Video">Music Video</option>
        <option value="Commercial">Commercial</option>
        <option value="Wedding">Wedding</option>
      </select>
      <select id="crew-role-filter">
        <option value="">Role 전체</option>
        <option value="연출">연출</option>
        <option value="촬영">촬영</option>
        <option value="조명">조명</option>
        <option value="음향">음향</option>
        <option value="편집">편집</option>
        <option value="미술">미술</option>
        <option value="제작">제작</option>
      </select>
      <label><input type="checkbox" id="crew-verified-only" /> Verified만</label>
    </div>

    <div>
      <div class="crew-group-title">Directors</div>
      <div id="directors-grid" class="crew-grid">
        <p class="placeholder-text">Director 불러오는 중...</p>
      </div>
    </div>

    <div style="margin-top:24px;">
      <div class="crew-group-title">Staff</div>
      <div id="staff-grid" class="crew-grid">
        <p class="placeholder-text">Staff 불러오는 중...</p>
      </div>
    </div>
  </main>

</div></div>

<script>
let ALL_CREW=[];

async function loadCrew(){
  try{
    const res=await fetch('/.netlify/functions/crew');
    const crew=await res.json();
    ALL_CREW=crew||[];
    bindFilters();
    render();
  }catch(e){console.error(e);}
}

function bindFilters(){
  [crew-search, crew-skill-filter, crew-role-filter, crew-verified-only].forEach(el=>{
    el.addEventListener('input', render);
    el.addEventListener('change', render);
  });
}

function render(){
  const search=(crew-search.value||'').toLowerCase().trim();
  const skill=crew-skill-filter.value;
  const role=crew-role-filter.value;
  const verifiedOnly=crew-verified-only.checked;

  const filtered=ALL_CREW.filter(c=>{
    if(verifiedOnly && !c.verified) return false;
    if(skill && !(c.skills||[]).includes(skill)) return false;
    if(role && !(c.roles||[]).includes(role)) return false;
    if(search){
      const hay=[c.name,c.bio,...(c.skills||[]),...(c.roles||[])].join(' ').toLowerCase();
      if(!hay.includes(search)) return false;
    }
    return true;
  });

  const directors=filtered.filter(c=>c.mainRole==='Director');
  const staff=filtered.filter(c=>c.mainRole==='Staff');

  directors-grid.innerHTML='';
  staff-grid.innerHTML='';

  const makeCard=(m)=>{
    const card=document.createElement('div');
    card.className='crew-card';
    card.innerHTML=`
      ${m.verified?`<div class="crew-verified">Verified</div>`:''}
      <div class="crew-avatar">${m.profileImageUrl?`<img src="${m.profileImageUrl}" alt="${m.name}">`:''}</div>
      <div class="crew-body">
        <div class="crew-name">${m.name||''}</div>
        <div class="crew-role-line">${(m.roles&&m.roles.length)?m.roles.join(' · '):(m.mainRole||'')}</div>
        ${m.bio?`<div class="crew-bio">${m.bio}</div>`:''}
        <div class="crew-tags">${(m.skills||[]).map(s=>`<span class="crew-tag">${s}</span>`).join('')}</div>
        <div class="crew-links">
          ${m.instagram?`<a href="${m.instagram}" target="_blank" onclick="event.stopPropagation()">Instagram</a>`:''}
          ${m.email?`<a href="mailto:${m.email}" onclick="event.stopPropagation()">${m.email}</a>`:''}
          ${m.phone?`<span>${m.phone}</span>`:''}
        </div>
      </div>`;
    card.addEventListener('click', ()=>location.href=`crew-detail.html?id=${m.id}`);
    return card;
  };

  if(!directors.length) directors-grid.innerHTML='<p class="placeholder-text">조건에 맞는 Director가 없습니다.</p>';
  else directors.forEach(m=>directors-grid.appendChild(makeCard(m)));

  if(!staff.length) staff-grid.innerHTML='<p class="placeholder-text">조건에 맞는 Staff가 없습니다.</p>';
  else staff.forEach(m=>staff-grid.appendChild(makeCard(m)));
}

document.addEventListener('DOMContentLoaded', loadCrew);
</script>
</body>
</html>