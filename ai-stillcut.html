<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./style.css"/>
  <title>AI Stillcut Reservation | Fiducia Collective</title>
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="./index.html">
        <div class="brand-title">Fiducia</div>
        <div class="brand-sub">COLLECTIVE</div>
      </a>
      <div class="nav-links">
        <a class="tab" href="./index.html">메인</a>
        <a class="tab active" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab" href="./gear.html">장비 예약</a>
        <a class="tab" href="./crew.html">감독/스태프 리스트</a>
        <a class="tab" href="./crew.html#register">감독/스태프 등록</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <div class="grid">

      <section class="card hero-center" style="grid-column:span 12;">
        <h3>ai stillcut reservation</h3>
        <p class="small">
          아래 정보를 입력하면 AI Stillcut Reservation DB로 저장됩니다.<br/>
          이미지는 메타정보만 저장되며, 원본은 카톡/드라이브로 전달 부탁!
        </p>
      </section>

      <section class="card" style="grid-column:span 12;">
        <form id="form" class="form">
          <div class="full">
            <label>프로젝트명 *</label>
            <input name="projectTitle" required placeholder="예) 웨딩 하이라이트 스틸컷"/>
          </div>

          <div>
            <label>연락처(전화) *</label>
            <input name="phone" required placeholder="010-0000-0000"/>
          </div>

          <div>
            <label>이메일 *</label>
            <input type="email" name="email" required placeholder="abc@email.com"/>
          </div>

          <div>
            <label>영상 타입 *</label>
            <select name="videoType" required>
              <option value="">선택</option>
              <option>웨딩</option>
              <option>뮤직비디오</option>
              <option>상업/광고</option>
              <option>브랜드/패션</option>
              <option>다큐/인터뷰</option>
              <option>기타</option>
            </select>
          </div>

          <div>
            <label>러닝타임 (분) *</label>
            <input name="runtime" inputmode="numeric" required placeholder="예) 3~5"/>
          </div>

          <div>
            <label>예산 범위 *</label>
            <select name="budgetRange" required>
              <option value="">선택</option>
              <option>50만원 ~ 100만원</option>
              <option>100만원 ~ 200만원</option>
              <option>200만원 ~ 300만원</option>
              <option>300만원 이상</option>
            </select>
          </div>

          <div>
            <label>희망 촬영 날짜 *</label>
            <input type="date" name="shootDate" required />
          </div>

          <div class="full">
            <label>촬영 장소 *</label>
            <input name="location" required placeholder="예) 부산 / 서울 강남 / 제주"/>
          </div>

          <div class="full">
            <label>레퍼런스 링크 (드라이브/유튜브/핀터레스트 등)</label>
            <input name="referenceLink" placeholder="https://..."/>
          </div>

          <div class="full">
            <label>이미지 파일 (최대 5개)</label>
            <input id="images" type="file" accept="image/*" multiple />
            <div id="fileNames" class="file-help"></div>
          </div>

          <div class="full">
            <label>요청 내용 *</label>
            <textarea name="message" required placeholder="원하는 무드/레퍼런스/필요 컷 등을 적어주세요"></textarea>
          </div>

          <div class="full row" style="justify-content:flex-end">
            <button class="btn" type="submit">예약 제출</button>
          </div>

          <div id="status" class="small full" style="margin-top:4px"></div>
        </form>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container row" style="justify-content:space-between">
      <div>© Fiducia Collective</div>
    </div>
  </footer>

  <script type="module">
    const form = document.querySelector("#form");
    const statusEl = document.querySelector("#status");
    const imagesInput = document.querySelector("#images");
    const fileNamesEl = document.querySelector("#fileNames");

    imagesInput.addEventListener("change", ()=>{
      const files = [...imagesInput.files].slice(0,5);
      if(imagesInput.files.length > 5){
        statusEl.textContent = "이미지는 최대 5개까지 선택 가능해요.";
      }
      fileNamesEl.innerHTML = files.map(f => `• ${f.name} (${Math.round(f.size/1024)}KB)`).join("<br/>");
    });

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      statusEl.textContent = "예약 전송 중...";

      const fd = new FormData(form);
      // 이미지 파일은 업로드 대신 "메타"만 저장
      const files = [...imagesInput.files].slice(0,5);
      const meta = files.map(f=>({ name:f.name, size:f.size, type:f.type }));
      fd.append("imagesMeta", JSON.stringify(meta));

      try{
        const res = await fetch("/api/stillcut-reservation", {
          method:"POST",
          body: fd
        });
        const data = await res.json();
        if(!res.ok){
          statusEl.textContent = "예약 실패: " + (data?.message || "Notion stillcut fetch error");
          return;
        }
        statusEl.textContent = "예약 완료! 확인 후 연락드릴게요.";
        form.reset();
        imagesInput.value = "";
        fileNamesEl.innerHTML = "";
      }catch(err){
        statusEl.textContent = "예약 실패: 네트워크/서버 오류";
      }
    });
  </script>
</body>
</html>