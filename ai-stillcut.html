<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./styles.css"/>
  <title>AI Stillcut Reservation | Fiducia Collective</title>
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="./index.html">
        <span class="brand-top">Fiducia</span>
        <span class="brand-bottom">COLLECTIVE</span>
      </a>
      <div class="nav-links">
        <a class="tab" href="./index.html">메인</a>
        <a class="tab active" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab" href="./gear.html">장비 예약</a>
        <a class="tab" href="./crew.html">감독/스태프 리스트</a>
        <a class="tab" href="./crew.html#register">감독/스태프 등록</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h1 class="page-title">ai stillcut reservation</h1>

    <section class="card">
      <p class="small">
        AI 스틸컷 예약을 위한 핵심 정보만 빠르게 받습니다.<br/>
        이미지 파일은 메타정보(파일명/개수)만 저장되고,
        원본은 카톡/드라이브 링크로 전달 부탁!
      </p>
    </section>

    <form id="form" class="card form-card">
      <div class="form-grid">
        <label>
          프로젝트명 *
          <input name="projectTitle" required class="input" placeholder="프로젝트명"/>
        </label>
        <label>
          연락처(전화) *
          <input name="phone" required class="input" placeholder="010-0000-0000"/>
        </label>
        <label>
          이메일 *
          <input name="email" type="email" required class="input" placeholder="email@example.com"/>
        </label>

        <label>
          영상 타입 *
          <select name="videoType" required class="input">
            <option value="">선택</option>
            <option>웨딩</option>
            <option>뮤직비디오</option>
            <option>광고/브랜디드</option>
            <option>영화/단편</option>
            <option>기타</option>
          </select>
        </label>

        <label>
          러닝타임(분) *
          <input name="runtime" type="number" min="1" required class="input" placeholder="예: 3"/>
        </label>

        <label>
          예산 범위 *
          <select name="budget" required class="input">
            <option value="">선택</option>
            <option>50만원 ~ 100만원</option>
            <option>100만원 ~ 200만원</option>
            <option>200만원 ~ 300만원</option>
            <option>300만원 이상</option>
          </select>
        </label>

        <label>
          희망 촬영 날짜 *
          <input name="shootDate" type="date" required class="input"/>
        </label>

        <label>
          촬영 장소 *
          <input name="location" required class="input" placeholder="예: 부산 / 서울 등"/>
        </label>

        <label style="grid-column:1/-1">
          레퍼런스 링크 (드라이브/유튜브/핀터레스트 등)
          <input name="referenceLink" class="input" placeholder="https://..."/>
        </label>

        <label style="grid-column:1/-1">
          이미지 파일 (최대 5개)
          <input id="images" name="images" type="file" multiple accept="image/*" class="input"/>
          <div id="imagesHelp" class="small" style="margin-top:6px"></div>
        </label>

        <label style="grid-column:1/-1">
          요청 내용 *
          <textarea name="message" required class="input textarea" rows="5" placeholder="원하는 분위기, 참고사항 등"></textarea>
        </label>
      </div>

      <button class="cta wide" type="submit">예약 제출</button>
      <div id="status" class="small" style="margin-top:10px"></div>
    </form>
  </main>

  <script type="module">
    const form = document.querySelector("#form");
    const statusEl = document.querySelector("#status");
    const imagesInput = document.querySelector("#images");
    const imagesHelp = document.querySelector("#imagesHelp");

    imagesInput.addEventListener("change", ()=>{
      const files = [...imagesInput.files].slice(0,5);
      if(imagesInput.files.length > 5){
        imagesHelp.textContent = "이미지는 최대 5개까지! 초과분은 자동 제외됨.";
      } else {
        imagesHelp.textContent = files.length ? `${files.length}장 선택됨` : "";
      }
    });

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      statusEl.textContent = "전송 중...";

      const fd = new FormData(form);
      const files = [...imagesInput.files].slice(0,5);
      const fileMeta = files.map(f=>({name:f.name, size:f.size, type:f.type}));
      fd.delete("images");
      fd.append("imagesMeta", JSON.stringify(fileMeta));

      const payload = Object.fromEntries(fd.entries());

      try{
        const res = await fetch("/api/stillcut", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const out = await res.json();
        if(!res.ok) throw new Error(out?.message || "예약 실패");
        statusEl.textContent = "예약 완료! 확인 후 연락드릴게요.";
        form.reset();
        imagesHelp.textContent="";
      }catch(err){
        statusEl.textContent = "예약 실패: " + err.message;
      }
    });
  </script>
</body>
</html>