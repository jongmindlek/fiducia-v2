<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="./style.css"/>
  <title>Crew Detail | Fiducia</title>
</head>
<body>

  <nav class="nav">
    <div class="container nav-inner">
      <a class="brand" href="./index.html">FIDUCIA COLLECTIVE</a>
      <div class="nav-links">
        <a class="tab" data-path="index.html" href="./index.html">메인</a>
        <a class="tab" data-path="ai-stillcut.html" href="./ai-stillcut.html">AI 스틸컷(예약)</a>
        <a class="tab" data-path="gear.html" href="./gear.html">장비 예약</a>
        <a class="tab" data-path="crew.html" href="./crew.html">감독/스태프 리스트</a>
        <a class="tab" data-path="crew.html#register" href="./crew.html#register">감독/스태프 등록</a>
      </div>
    </div>
  </nav>

  <main class="container section">
    <a href="./crew.html" class="small" style="display:inline-block;margin-top:8px">← crew로 돌아가기</a>

    <section id="detail" class="card" style="margin-top:12px">
      <div class="small">불러오는 중...</div>
    </section>
  </main>

  <script>
    (function () {
      const tabs = document.querySelectorAll(".nav .tab");
      const path = location.pathname.split("/").pop() || "index.html";
      const hash = location.hash || "";
      tabs.forEach(a => a.classList.remove("active"));
      if (path === "crew.html" && hash === "#register") {
        const regTab = document.querySelector('.nav .tab[data-path="crew.html#register"]');
        if (regTab) regTab.classList.add("active");
        return;
      }
      const activeTab = document.querySelector(`.nav .tab[data-path="${path}"]`);
      if (activeTab) activeTab.classList.add("active");
    })();
  </script>

  <script type="module">
    const detailEl = document.querySelector("#detail");
    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    const thumb = (url) => url
      ? `<img src="${url}" alt="profile" loading="lazy"/>`
      : `<div class="thumb big">no image</div>`;

    async function load(){
      try{
        const res = await fetch("/api/crew");
        const data = await res.json();
        const crew = (Array.isArray(data)?data:[]).find(x=>String(x.id)===String(id));
        if(!crew){
          detailEl.innerHTML = `<div class="small">해당 크루를 찾지 못했어요.</div>`;
          return;
        }

        detailEl.innerHTML = `
          <div class="row" style="gap:14px;align-items:center;flex-wrap:wrap">
            <div class="thumb big">${thumb(crew.profileImageUrl)}</div>
            <div>
              <h2 style="margin:0">${crew.name || "Unnamed"}</h2>
              <div class="small" style="margin-top:4px">${crew.mainRole || ""}</div>
              ${crew.verified ? `<div class="tag verified" style="margin-top:6px;display:inline-block">Verified</div>` : ""}
            </div>
          </div>

          <div style="margin-top:14px">
            <h4>Bio</h4>
            <p class="small">${crew.bio || "-"}</p>
          </div>

          <div style="margin-top:10px">
            <h4>Roles</h4>
            <div class="tags">
              ${(crew.roles||[]).map(r=>`<span class="tag">${r}</span>`).join("") || "<span class='small'>-</span>"}
            </div>
          </div>

          <div style="margin-top:10px">
            <h4>Skills</h4>
            <div class="tags">
              ${(crew.skills||[]).map(s=>`<span class="tag">${s}</span>`).join("") || "<span class='small'>-</span>"}
            </div>
          </div>

          <div style="margin-top:12px" class="row" style="gap:8px;flex-wrap:wrap">
            ${crew.instagram ? `<a class="cta small" target="_blank" rel="noopener" href="${crew.instagram}">Instagram</a>` : ""}
            ${crew.email ? `<a class="cta small" href="mailto:${crew.email}">Email</a>` : ""}
            ${crew.phone ? `<a class="cta small" href="tel:${crew.phone}">Phone</a>` : ""}
          </div>
        `;
      }catch(e){
        detailEl.innerHTML = `<div class="small">불러오기 실패</div>`;
      }
    }
    load();
  </script>

</body>
</html>