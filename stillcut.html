<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>AI Stillcut Reservation</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css" />
<link rel="stylesheet" href="style.css" />
</head>

<body>
<div class="page"><div class="inner">

  <div class="nav-wrap">
    <nav class="nav">
      <div class="nav-logo">FIDUCIA COLLECTIVE</div>
      <div class="nav-menu">
        <a href="index.html">메인</a>
        <a href="stillcut.html" class="is-active">AI 스틸컷(예약)</a>
        <a href="gear.html">장비 예약</a>
        <a href="crew-list.html">감독/스태프 리스트</a>
        <a href="register.html">감독/스태프 등록</a>
      </div>
    </nav>
  </div>

  <main>
    <h2 class="section-title" style="margin-top:20px;">AI stillcut reservation</h2>

    <div class="form-card">
      <div class="form-grid">
        <div class="form-row"><label>프로젝트 제목</label><input id="sc-title" placeholder="예: 브랜드 런칭 티저"/></div>
        <div class="form-row"><label>의뢰인/팀 이름</label><input id="sc-client" placeholder="예: Fiducia Marketing"/></div>
        <div class="form-row"><label>연락처(카톡/전화/이메일)</label><input id="sc-contact" placeholder="@kakaoid / 010-0000-0000"/></div>

        <div class="form-row"><label>프로젝트 타입</label>
          <select id="sc-type">
            <option value="">선택</option>
            <option value="Film">Film</option>
            <option value="Music Video">Music Video</option>
            <option value="Commercial">Commercial</option>
            <option value="Wedding">Wedding</option>
          </select>
        </div>

        <div class="form-row"><label>레퍼런스 링크(선택)</label><input id="sc-ref-link" placeholder="https://..."/></div>
        <div class="form-row"><label>레퍼런스 이미지 URL 1</label><input id="sc-img-1" placeholder="https://image-url..."/></div>
        <div class="form-row"><label>레퍼런스 이미지 URL 2</label><input id="sc-img-2" placeholder="https://image-url..."/></div>
        <div class="form-row"><label>레퍼런스 이미지 URL 3</label><input id="sc-img-3" placeholder="https://image-url..."/></div>

        <div class="form-row"><label>요구/무드 설명</label>
          <textarea id="sc-desc" placeholder="원하는 분위기, 캐릭터, 컬러, 장면 등 자유롭게 적어줘"></textarea>
        </div>

        <div class="form-row"><label>희망 마감일(선택)</label><input id="sc-deadline" type="date"/></div>

        <div class="form-row">
          <label>선호 감독(선택)</label>
          <select id="sc-preferred" multiple style="height:110px;"></select>
          <div class="placeholder-text" style="margin-top:4px;">(여러 명 선택 가능)</div>
        </div>
      </div>

      <div class="form-actions">
        <button class="cta-btn" id="sc-submit" type="button">스틸컷 예약 제출</button>
        <a class="cta-btn" href="index.html" style="background:rgba(79,125,255,.12);box-shadow:none;border-color:var(--border-subtle);">메인으로</a>
      </div>
      <div id="sc-msg" class="form-msg"></div>
    </div>
  </main>

</div></div>

<script>
async function loadPreferred(){
  try{
    const res = await fetch('/.netlify/functions/crew');
    const crew = await res.json();
    const pref = document.getElementById('sc-preferred');
    pref.innerHTML='';
    (crew||[]).filter(c=>c.mainRole==='Director').forEach(d=>{
      const opt=document.createElement('option');
      opt.value=d.id; opt.textContent=d.name;
      pref.appendChild(opt);
    });
  }catch(e){console.error(e);}
}

async function submitStillcut(){
  const msg=document.getElementById('sc-msg');
  msg.className='form-msg'; msg.textContent='전송 중...';

  const preferredSelect = document.getElementById('sc-preferred');
  const preferredCrewIds = Array.from(preferredSelect.selectedOptions).map(o=>o.value);

  const payload={
    title: document.getElementById('sc-title').value,
    clientName: document.getElementById('sc-client').value,
    contact: document.getElementById('sc-contact').value,
    projectType: document.getElementById('sc-type').value,
    referenceLink: document.getElementById('sc-ref-link').value,
    description: document.getElementById('sc-desc').value,
    deadline: document.getElementById('sc-deadline').value,
    preferredCrewIds,
    referenceImageUrls:[
      document.getElementById('sc-img-1').value,
      document.getElementById('sc-img-2').value,
      document.getElementById('sc-img-3').value
    ],
  };

  try{
    const res=await fetch('/.netlify/functions/stillcut-create', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data=await res.json();
    if(!res.ok || !data.ok) throw new Error(data.details||data.message);
    msg.className='form-msg ok';
    msg.textContent='✅ 예약이 접수됐어! 곧 카톡으로 안내할게.';
    document.getElementById('sc-submit').disabled=true;
  }catch(e){
    msg.className='form-msg bad';
    msg.textContent='❌ 전송 실패: '+(e.message||'');
  }
}

document.addEventListener('DOMContentLoaded', ()=>{
  loadPreferred();
  document.getElementById('sc-submit').addEventListener('click', submitStillcut);
});
</script>
</body>
</html>